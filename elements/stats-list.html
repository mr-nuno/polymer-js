<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="stats-list">
  <template>
  	<link rel="stylesheet" type="text/css" href="../bower_components/semantic/build/packaged/css/semantic.css">
  	<link rel="stylesheet" href="../css/app.css">
  	<core-ajax id="fetcher" url="/api/stats" handleAs="json"></core-ajax>
  	<table class="ui table">
      <thead class="ui header">
        <tr>
          <th colspan="2">{{header}}</th>
        </tr>
      </thead>
      <tbody>
      	<template repeat="{{item in items}}">
					<tr>
            <td class="ui small header">{{item.label}}</td>
						<td>{{item.value}}</td>
					</tr>
        </template>
      </tbody>
      <tfoot>
        <tr>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
        </tr>
      </tfoot>
     </table>
  </template>
  <script>
    Polymer('stats-list', {
      header: "",
    	ready: function() {
        var _this = this;
        document.querySelector('action-bar').addEventListener('fetch', function(e) {
          _this.fetch(e.detail.game, e.detail.nickname);
        });
    	},
      fetch: function(game, nickname) {
        var ajax = this.$.fetcher;
        ajax.url = "/api/stats/" + game + "/" + nickname;
        var _this = this;
        ajax.addEventListener('core-response', function(e) {
          _this.header = nickname + " on " + game;
          _this.items = this.response;
          console.log(this.response);
        });

        ajax.go();
      }
    });
  </script>
</polymer-element>